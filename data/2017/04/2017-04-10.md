[bouzuya/bbna][] をつくっている。いまは通信処理を書いている。よく分からないままに書いている。

Java は同期的に通信ができるので……いや、さすがにメインスレッドで通信処理もまずい。非同期処理だ。 [`Loader`](https://developer.android.com/guide/components/loaders.html) というコンポーネントを使う。`Loader` の一種である [`AsyncTaskLoader`](https://developer.android.com/reference/android/content/AsyncTaskLoader.html) を使う。

`Loader` は Support Package の [`LoaderManager`](https://developer.android.com/reference/android/support/v4/app/LoaderManager.html) 経由で使っている。`Loader` がひとつしかないのに `LoaderManager` が要るのか分からないけど、再利用がどうとか書いてあるのでうまく管理してくれるのだろう。結果を受け取るために `MainActivity` に [`LoaderManager.LoaderCallbacks`](https://developer.android.com/reference/android/support/v4/app/LoaderManager.LoaderCallbacks.html) を実装する。うーん。

`AsyncTaskLoader` の `loadInBackground` では [`HttpURLConnection`](https://developer.android.com/reference/java/net/HttpURLConnection.html) を使って通信処理を書く。昔は `HttpClient` がどうのこうのという記述を見かけるが、[6.0 で削除されたらしい](https://developer.android.com/about/versions/marshmallow/android-6.0-changes.html#behavior-apache-http-client) ので、 `HttpURLConnection` を使う。サードパーティにもっと便利なのもありそうだけど、とりあえず標準で。

`InputStream` って懐かしいな。そして面倒くさいな。`InputStream` を `InputStreamReader` で wrap して `BufferedReader` で wrap して……。ああ面倒くさい。検査例外。 `IOException` 。面倒くさい。`Log.e()` で吐きつつ、とりあえずは無視。 `String` に `null` が含まれている……、うーん。……いま書いていて、そういえば、もう `Maybe` 相当の `class` がある気がしてきた……。気にせず [`@Nullable`](https://developer.android.com/reference/android/support/annotation/Nullable.html) や [`@NonNull`](https://developer.android.com/reference/android/support/annotation/NonNull.html) をつけつつ進める。この annotation に意味があるのか……。

明日は JSON を parse する感じかな……。

[bouzuya/bbna]: https://github.com/bouzuya/bbna
