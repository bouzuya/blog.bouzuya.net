[bouzuya/serde-firestore-value] を 0.26.1 にアップデートした。

serde-firestore-value は [crates:serde] のデータフォーマットのひとつで、 [crates:googleapis-tonic-google-firestore-v1] の Value をデータフォーマットにするもの。 [crates:googleapis-tonic-google-firestore-v1] は [crates:tonic] (内部的には [crates:prost] を使用) で [googleapis/googleapis] の proto を Rust にしたもののうち、 Firestore V1 API を対象にしたもの。

簡単に言うと serde-firestore-value は Firestore V1 API で使用するデータ型に serde での変換を提供する crate 。

今回の 0.26 での変更点は `FieldReferenceValue`, `FunctionValue`, `PipelineValue` への対応。これは Firestore の実験的な機能に使われるもの。

Firestore は Enterprise edition かつ native mode のデータベースに対しての pipeline という新しいクエリインタフェースを追加している。公式のドキュメントは <https://firebase.google.com/docs/firestore/pipelines/get-started-with-pipelines> にある。

パイプラインクエリを実行する API が追加されていて、パイプラインは複数のステージを持つ。ステージにはクエリの対象となるデータソースを表す入力ステージや、それらを条件で絞り込んだり集計したりする変換ステージがある。変換ステージには関数を指定したり、関数の対象としてフィールドの参照を指定できる。

……とまあこんな感じで `FieldReference`, `Function`, `Pipeline` (あとは `Stage`) が追加されている。

Enterprise edition にしておかないといけないので、検証にもひとてまかかった ([bouzuya/bouzuya-firestore-client] で検証した) 。 Enterprise edition だと Firebase コンソールの見え方もすこし違っていて、 Query Explain なども表示されていて、なかなか良さそうだった。

proto から生成した `Function` や `Pipeline` や `Stage` を使用してしまうと `serde::Serialize` / `serde::Deserialize` できない `Value` を含んでいるので、そこを避けるために serde-firestore-value から独自の型を追加で定義することになった。今回の実装が大げさになってしまった要因のひとつである。

軽く検証したものの、細かく使えていないので何か問題があるかもしれない。今回のリリースはリファクタリングもそれなりに含んでいるので、そこでの問題もあるかもしれない。

くたびれた。

---

今日のコミット。

- [bouzuya-firestore-client](https://github.com/bouzuya/bouzuya-firestore-client) 8 commits
  - [Update .gitignore](https://github.com/bouzuya/bouzuya-firestore-client/commit/06662032e18787d1706ebbb29c2bd4c514954f45)
  - [Add pipeline example](https://github.com/bouzuya/bouzuya-firestore-client/commit/03365d94736829922bd20cc6e7dc6b94897003c1)
  - [Change rustfmt settings to use imports_granularity = Item](https://github.com/bouzuya/bouzuya-firestore-client/commit/a9b80e8a7c97a22b4a62d14d0022f4acc48acc98)
  - [Add re-export mod rule](https://github.com/bouzuya/bouzuya-firestore-client/commit/e041c36580523fef8ef99647cb1ce44333cb6288)
  - [Add format rule](https://github.com/bouzuya/bouzuya-firestore-client/commit/74fb0b0b8dfb3cbc8cb8cade030d67773fc652c9)
  - [Add AGENTS.md](https://github.com/bouzuya/bouzuya-firestore-client/commit/669e23177caae1cc2f6eaf341e7892d21fa7bb34)
  - [cargo init](https://github.com/bouzuya/bouzuya-firestore-client/commit/feb9722fe3c7af6458534fe60ec1017d91cae2c9)
  - [Initial commit](https://github.com/bouzuya/bouzuya-firestore-client/commit/3188b514bd7b5c596aac39f7458fd2f575a9fa01)
- [serde-firestore-value](https://github.com/bouzuya/serde-firestore-value) 4 commits
  - [0.26.1](https://github.com/bouzuya/serde-firestore-value/commit/b6fccaf0467281825058ffd21c2f80038af2f10b)
  - [Fix bytes feature tests](https://github.com/bouzuya/serde-firestore-value/commit/837637b68fc490932de386666051c34a5f87b201)
  - [Fix btree-map feature build](https://github.com/bouzuya/serde-firestore-value/commit/f6155fb3ecec81f685f64f2dcec88999e4672fdd)
  - [0.26.0](https://github.com/bouzuya/serde-firestore-value/commit/c7c09776830d4006fdd7be4746733a2a7f68d943)
- [tsukota-web](https://github.com/bouzuya/tsukota-web) 3 commits
  - [Remove claude-code devcontainer feature](https://github.com/bouzuya/tsukota-web/commit/3716a1c45e7339e00bf5040dbf93d2895cc8d412)
  - [Update CI workflow to use the dev container](https://github.com/bouzuya/tsukota-web/commit/6d489d66656be570be9731b9cf756036ce2d953a)
  - [cargo +nightly fmt](https://github.com/bouzuya/tsukota-web/commit/af7449a49c58ef9d361bb6c398c79d321bdc1c22)
- [googleapis-tonic](https://github.com/bouzuya/googleapis-tonic) 1 commit
  - [Regenerate crates using googleapis/google#7f62014053cd26b1acb7a1d0bf167104b64e3690](https://github.com/bouzuya/googleapis-tonic/commit/b92dfa1159714b02bc31019e265908d2b7a8206b)

[bouzuya/bouzuya-firestore-client]: https://github.com/bouzuya/bouzuya-firestore-client
[bouzuya/serde-firestore-value]: https://github.com/bouzuya/serde-firestore-value
[crates:googleapis-tonic-google-firestore-v1]: https://crates.io/crates/googleapis-tonic-google-firestore-v1
[crates:prost]: https://crates.io/crates/prost
[crates:serde]: https://crates.io/crates/serde
[crates:tonic]: https://crates.io/crates/tonic
[googleapis/googleapis]: https://github.com/googleapis/googleapis
