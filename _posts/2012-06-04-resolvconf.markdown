---
layout: post
pubdate: "2012-06-04T22:16:28+09:00"
title: resolvconfを使う
tags: ubuntu
pagetype: posts
---
いつからそうなっていたのかは分からないのだけれど、`/etc/resolv.conf`がシンボリックリンクになっていた。Ubuntu 12.04 LTSにバージョンアップしたときに変わったのかもしれない。編集しようと開くとコメントにこんなことが書いてある。

    # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
    #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN

「`resolvconf(8)`によって生成されるファイルだから手で編集するんじゃねーぞ」とそんな感じの内容である。

`man 8 resolvconf`してみると、resolvconfを使えば`/etc/network/interfaces`に`dns-nameservers ...`とか`dns-search`とか書けて、`/etc/resolv.conf`を自動更新してくれるらしい。

以前から設定ファイルが散っていて編集がわずらわしかったので`resolvconf`を使うことにした。

注意しないといけない点がふたつある。

ひとつめは`NetworkManager`が有効になっていると、そちらの設定をいっしょに`/etc/resolv.conf`に追記してしまう。たとえば`/etc/network/interfaces`には`dns-nameservers 192.168.1.3`と書いていても、`/etc/resolv.conf`に`nameserver 127.0.0.1`などと記録されたりする。

対策としてNetworkManagerを止めて、それについての設定を削除した。NetworkManagerは止めるとGUIでの設定ができなくなるので注意が要る。

    $ sudo service network-manager stop
    $ sudo resolvconf -d NetworkManager

ちなみに`resolvconf`の設定類は`/etc/resolvconf/*`とか`/run/resolvconf/*`あたりに保存される。

ふたつめは`ifdown`や`ifup`コマンドを実行しないと`/etc/resolv.conf`に反映されないということ。`/etc/network/interfaces`に追記して、すぐに`/etc/resolv.conf`を開いても反映されていない。`ifdown`や`ifup`でインタフェースを再起動すると、そのタイミングで反映される。

    $ sudo ifdown eth0
    $ sudo ifup eth0

英語が読めないのでよく分からないけど、すぐに反映もできそうなんだけどなあ。めんどうなので現状に妥協する。

22 min.

<ins datetime="2012-06-11T22:58:04+09:00">[DHCPサーバーを立てる](http://bouzuya.github.com/2012/06/11/dhcp-server.html)方がずっと良いです。</ins>
