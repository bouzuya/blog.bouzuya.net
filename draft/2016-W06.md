# goal

- [x] 1 年前の日記を twitter へ投稿できるようにする
- [x] virtual-dom-ssr の client-side routing
- [ ] virtual-dom-ssr の更新系処理
- [ ] すごい Haskell たのしく学ぼう ! の写経を終わらせる

# diary

- 2016-02-14 Sun virtual-dom-ssr の大幅リファクタリング。
- 2016-02-13 Sat Twitter に 1 年前の記事を投稿スクリプトを追加。『アイアンマン』
- 2016-02-12 Fri 『スターウォーズ VII フォースの覚醒』
- 2016-02-11 Thu 建国記念の日。すごい Haskell たのしく学ぼう写経 5 章。『ジャックと天空の巨人』
- 2016-02-10 Wed Haskell 写経 3, 4 章。
- 2016-02-09 Tue RALLY の大きい変更の打ち合わせ。RxJS + virtual-dom に変更の変更を検討。PromisedState の画面ロックを疑問視。
- 2016-02-08 Mon Kobe.rb #35 に参加した。

# blog

- 2016-02-14 Sun 今週のふりかえり
- 2016-02-13 Sat 『スターウォーズ』
- 2016-02-12 Fri 『ジャックと天空の巨人』
- 2016-02-11 Thu 建国記念の日。Haskell 写経
- 2016-02-10 Wed 2016-02-07 virtual-dom-ssr
- 2016-02-09 Tue 2016-02-07 blog.bouzuya.net OGP
- 2016-02-08 Mon Kobe.rb #35

## 2016-02-13 Sat

映画『スター・ウォーズ フォースの覚醒』を観た。ネタバレをする。

映画館で字幕 3 D 環境で観た。

ぼくは公開されるまで観たいと思っていたのだけど評判を聞いて尻込みしていた。妻が観たいと言うので「オデッセイを観たいんだけど……」などと文句を垂れながら観に行った。

要約する。旧帝国軍であるファースト・オーダーとレイア・オーガナの率いるレジスタンスが戦っている。ハン・ソロとレイア・オーガナの息子であるカイロ・レンをルーク・スカイウォーカーに預けていたが、カイロ・レンはダークサイドに堕ちてしまいファースト・オーダー側の幹部として登場する。それが理由なのか、ルーク・スカイウォーカーは姿をくらましている。ここまでが物語以前のできごと。物語は、レジスタンスがルークの居場所を記した地図の一部を手に入れ、それをファースト・オーダーが奪おうとするところからはじまる。地図を隠したドロイド BB-8 が逃亡中に主人公であるレイと出会う。レイはファースト・オーダーから逃げてきたストーム・トルーパーのフィンと共にさらに逃亡を続け、ハン・ソロやチューバッカと出会い、レジスタンスに合流し、ファースト・オーダーの惑星破壊兵器であるスターキラーと戦う。その過程でハン・ソロは息子であるカイロ・レンに殺され、レイはフォースに目覚めはじめる。完全な地図を入手し、レイがルーク・スカイウォーカーに出会うところまでで終わり。

強い女性の主人公が好きだ。ただ本作ではまだ潜在的な様子で、episode 1 のアナキンのように強いフォースでちやほやされているような状態。精神的に弱いのが気になる。また、それは episode 4 からの層に合っているのか疑問だ。

老人が多い。あまりの多さに 40 年目の同窓会かと思った。

昔の要素を取り入れようと必死なのは分かる。逃げるドロイドと主人公の出会いやスターファイターでの敵施設への突撃などのシーン的なものから、ハン・ソロ、チューバッカ、レイア・オーガナ、ルーク・スカイウォーカーなどの過去の登場人物、ダース・ベイダーのようなカイロ・レンとデス・スターのようなスターキラーなどの悪役たちなど。個人的にはその必死さが逆に嫌だし、物語がややこしくなってしまっているような……、テンポが全体的に悪いと感じるのもそのせいかもしれない。取り入れようとする一方で 1 作目からの登場人物であるハン・ソロを殺してしまったりというのはどうなんだろう……。

ジュラシック・ワールドのとき ([2015-08-29][]) ほどのがっかりさはないが、ぼくの中ではもやもやとしている。

## 2016-02-12 Fri

映画『ジャックと天空の巨人』を観た。

いつだったかの地上波放送の録画を観た。「王冠」という概念はもともとの話にあったかは分からない。伏線は明らかで驚きの展開はあまりない。明らかな伏線を伏線と読んでいいのかは分からない。面白くないかというと、早く時間が過ぎたように感じられたので悪くなかったのではないかと思う。

## 2016-02-11 Thu

すごい Haskell たのしく学ぼう ! の 5 章を写経した。

今週の目標には「すごい Haskell たのしく学ぼう ! の写経を終わらせる」ことがある。その達成のためだ。

今日は建国記念の日でお休みなので、それを利用して一気に進めようとした。しかし、今日一日で 5 章の 1 章分しか進まなかったので、全部で 15 章まであるすごい Haskell たのしく学ぼう ! を今週で終えられそうにない。

5 章は高階関数。高階関数・カリー化・ラムダ式・ map ・ filter ・ foldl/r ・ $ ・ 関数合成 (.) ・ポイントフリースタイル。

Haskell の関数の結合の規則や currying など C 系の Java / JavaScript とは随分と違っている。たとえば `f g 1` は、 CoffeeScript では `f(g(1))` だけど、 Haskell では `((f g) 1)` になる。Java では error になりそうな `f g` も部分適用として扱われ、自動で currying されているので、次の引数を取る関数が返される。あとは `$` と `.` を使って、括弧を減らし簡潔にできるあたりも良い。

個人的に記録しておきたい点は「 foldr で無限リストを扱える」こと。Haskell が遅延評価であるために次のような記述が動く。

```
ghci> let and' = foldr (&&) True
ghci> and' $ repeat False
```

## 2016-02-10 Wed

[2016-02-07][] に [bouzuya/virtual-dom-ssr][] に event listener を追加したことを書く。

virtual-dom-ssr は [Matt-Esch/virtual-dom][] と EventEmitter で server-side rendering の検証をするための project 。これは先週に何度か書いている。

- [2016-02-04][]
- [2016-02-05][]
- [2016-02-06][]

今回の目的は、この virtual-dom-ssr の client-side で click などの event を取れるようにすることだ。

実装は [cyclejs/cycle-dom][] に近い。VTree の render と event listener の設定を完全に分離している。例えるなら React にある `<button onClick={...}/>` のような形ではなく、jQuery の `$('button').on('click', ...)` のような形だ。 event listener を root element に設定し、発生した event の target を [`Element.matchesSelector`](https://developer.mozilla.org/ja/docs/Web/API/Element/matches) で検査することで実現している。

類似の実装は [2016-01-29][] の [bouzuya/my-cycle][] で既に試している。今回は [cyclejs/cycle-dom][] を見ずに必要分だけを実装している。

一応のところは動くのだけど event listener が増えたときの速度やその他の未知の問題などを気にしている。

## 2016-02-09 Tue

[2016-02-07][] に blog.bouzuya.net を OGP 対応させたことを書く。

OGP は Open Graph Protocol の略だ。これは Facebook や Twitter が URL を共有した際の表示に利用している meta data だ。詳細は [ogp.me](http://ogp.me/) を参照すると良い。

今回の対応の目的は blog.bouzuya.net の利用者を増やすことだ。そのために Twitter からの流入を増やしたい。現状は blog.bouzuya.net を更新した後に URL および title を tweet している。その情報をより良く、目立たせようというねらいだ。

blog.bouzuya.net は Node.js, CoffeeScript, React, gulp あたりを使っている。 framework は未使用だ。pre-rendering は gulp で強引に呼び出して HTML を local に出力することで実現している。今回の修正はその gulpfile.coffee に手を入れた。

課題がいくつか残っている。 `og:image` が常に favicon と同じものに固定されている点や `og:description` の切る位置が最大 100 文字に固定されている点などだ。Markdown をそのまま `og:description` に使っているために `[link text](link)` などが表示される点も課題だろう。

ひとまずは様子を見る。母集団がぼくの follower なので、そこまでの効果は期待できない。最近の常識をひとつ備えたに過ぎない。

## 2016-02-08 Mon

[Kobe.rb Meetup #35](https://koberb.doorkeeper.jp/events/38610) に参加したことを書く。

Kobe.rb は「神戸やその周辺のRubyistが集まる会」だそうで。詳細は [koberb.doorkeeper.jp](https://koberb.doorkeeper.jp/) を参照すると良い。blog.bouzuya.net に書いた範囲での、ぼくの参加状況は次のとおりだ。

- [2016-02-08][] [#35](https://koberb.doorkeeper.jp/events/38610)
- [2016-01-13][] [#33](https://koberb.doorkeeper.jp/events/36997)
- [2014-09-29][] [#5](https://koberb.doorkeeper.jp/events/15522)
- [2014-09-14][] [#4](https://koberb.doorkeeper.jp/events/14981)
- [2014-08-26][] [#3](https://koberb.doorkeeper.jp/events/14536)
- [2014-08-03][] [#1](https://koberb.doorkeeper.jp/events/13652)

今回も静かな中でもくもくと作業。virtual-dom + EventEmitter の修正。集中できるのだけど、お腹が空く。
